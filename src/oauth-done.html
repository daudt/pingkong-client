<!DOCTYPE html>
<html>
<body>
  <script>

    (function() {

      var oAuthVarTranslations = {
        auth_token: 'token',
        client_id:  'clientID',
        uid:        'uid',
        expiry:     'expirationSecs'
      }

      // from http://stackoverflow.com/questions/2090551/parse-query-string-in-javascript
      function getQueryVariable(varName) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split('=');
          if (decodeURIComponent(pair[0]) == varName) {
            return decodeURIComponent(pair[1]);
          }
        }
        console.log('Query var %s not found', varName);
      }

      function storeOAuthSession() {
        var queryVarNames = Object.keys(oAuthVarTranslations);
        for (var i = 0; i < queryVarNames.length; i++) {
          var queryVarName = queryVarNames[i];
          var storageValue = getQueryVariable(queryVarName);
          if (storageValue) {
            var storageVarName = oAuthVarTranslations[queryVarName];
            localStorage.setItem(storageVarName, storageValue);
          }
        }
      }

      storeOAuthSession();

    })();

  </script>
</body>
</html>
